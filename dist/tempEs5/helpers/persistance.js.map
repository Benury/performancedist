{"version":3,"sources":["../../tempCollect/helpers/persistance.js"],"names":["storageKey","persistance","getMetrics","timestamp","Date","data","perfTiming","navigationStart","toISOString","url","window","location","href","requests","requestsOnly","length","domains","requestsByDomain","subDomainsOfTld","hostSubdomains","requestsToHost","hostRequests","tldAndSubdomainRequests","currAndSubdomainRequests","total","loadEventEnd","timeToFirstByte","responseStart","domContentLoading","domContentLoadedEventStart","domLoading","domProcessing","domComplete","getStoredValues","JSON","parse","localStorage","getItem","persistanceEnabled","activatePersistance","saveLatestMetrics","deactivatePersistance","dump","push","setItem","stringify","clear","sourceData","console","log","removeItem","PerformanceBookmarklet","persistedData","table","dir"],"mappings":"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","sourcesContent":["import data from \"../data\";\r\n\r\nconst storageKey = \"performance-bookmarklet-metrics\";\r\n\r\nconst persistance = {};\r\n\r\nconst getMetrics = () => {\r\n\treturn {\r\n\t\ttimestamp: (new Date(data.perfTiming.navigationStart)).toISOString(),\r\n\t\turl: window.location.href,\r\n\t\trequests: data.requestsOnly.length,\r\n\t\tdomains: data.requestsByDomain.length,\r\n\t\tsubDomainsOfTld: data.hostSubdomains,\r\n\t\trequestsToHost: data.hostRequests,\r\n\t\ttldAndSubdomainRequests: data.currAndSubdomainRequests,\r\n\t\ttotal: data.perfTiming.loadEventEnd - data.perfTiming.navigationStart,\r\n\t\ttimeToFirstByte: data.perfTiming.responseStart - data.perfTiming.navigationStart,\r\n\t\tdomContentLoading: data.perfTiming.domContentLoadedEventStart - data.perfTiming.domLoading,\r\n\t\tdomProcessing: data.perfTiming.domComplete - data.perfTiming.domLoading\r\n\t};\r\n};\r\n\r\nconst getStoredValues = () => {\r\n\treturn JSON.parse(localStorage.getItem(storageKey)) || [];\r\n};\r\n\r\npersistance.persistanceEnabled = () => {\r\n\treturn !!JSON.parse(localStorage.getItem(storageKey));\r\n};\r\n\r\npersistance.activatePersistance = () => {\r\n\tpersistance.saveLatestMetrics();\r\n};\r\n\r\n\r\npersistance.deactivatePersistance = () => {\r\n\tpersistance.dump();\r\n};\r\n\r\n\r\npersistance.saveLatestMetrics = () => {\r\n\tconst data = getStoredValues();\r\n\tdata.push(getMetrics());\r\n\tlocalStorage.setItem(storageKey, JSON.stringify(data));\r\n};\r\n\r\n\r\n/**\r\n* Dump the current page metrics from the data store to the console.\r\n*\r\n* Example:\r\n*    PerformanceBookmarklet.PageMetric.dump(); // Dumps the data as TSV and clears the data store.\r\n*    PerformanceBookmarklet.PageMetric.dump(false); // Dumps the data as CSV and retains the data.\r\n*\r\n* @param [Boolean] clear Should the data be cleared from the data store?\r\n*/\r\npersistance.dump = (clear = true) => {\r\n\tconst sourceData = getStoredValues();\r\n\r\n\t// Nothing to analyze. Return early.\r\n\tif(sourceData.length === 0){\r\n\t  console.log(\"There are no page metrics. Please tick the 'Persist Data' checkbox.\");\r\n\t  return;\r\n\t}\r\n\r\n\t// Remove the data from the data store.\r\n\tif(clear === true){\r\n\t  localStorage.removeItem(storageKey);\r\n\t  console.log(\"Storage for %s has been cleared\", storageKey);\r\n\t}\r\n\r\n\t//make accessible publicly only when button is pressed\r\n\twindow.PerformanceBookmarklet = {\r\n\t\tpersistedData : sourceData\r\n\t};\r\n\tif(console.table){\r\n\t\tconsole.log(\"Data also accessible via %cwindow.PerformanceBookmarklet.persistedData%c:\\n\\n%o\", \"font-family:monospace\", \"font-family:inherit\", window.PerformanceBookmarklet);\r\n\t\tconsole.table(sourceData);\r\n\t}else{\r\n\t\t//IE fallback\r\n\t    console.log(\"Data also accessible via window.PerformanceBookmarklet.persistedData\");\r\n\t    console.dir(window.PerformanceBookmarklet.persistedData);\r\n\t}\r\n};\r\n\r\n\r\nexport default persistance;\r\n"],"file":"persistance.js"}