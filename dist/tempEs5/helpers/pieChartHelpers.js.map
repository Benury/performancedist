{"version":3,"sources":["../../tempCollect/helpers/pieChartHelpers.js"],"names":["pieChartHelpers","unit","Math","PI","createWedge","id","size","startAngle","percentage","labelTxt","colour","radius","endAngle","labelAngle","x1","sin","y1","cos","x2","y2","x3","y3","big","d","path","svg","newEl","fill","appendChild","text","addEventListener","evt","target","style","opacity","ownerDocument","getElementById","getAttribute","backgroundColor","wedgeLabel","newTextEl","setAttribute","getNodeTextWidth","chartMaxHeight","contentWidth","window","innerWidth","createPieChart","data","chart","viewBox","labelWrap","wedgeWrap","forEach","dataObj","wedgeData","perc","label","count","helper","getRandomColor","cx","cy","r","createChartTable","title","columns","name","field","dom","tableFactory","thead","newTag","column","tbody","y","row","toString","toPrecision"],"mappings":"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","sourcesContent":["import helper from \"../helpers/helpers\";\r\nimport svg from \"../helpers/svg\";\r\nimport dom from \"../helpers/dom\";\r\n\r\nconst pieChartHelpers = {};\r\n\r\nconst unit = (Math.PI * 2) / 100;\r\n\r\nconst createWedge = (id, size, startAngle, percentage, labelTxt, colour) => {\r\n\tconst radius = size/2,\r\n\t\tendAngle = startAngle + (percentage * unit - 0.001),\r\n\t\tlabelAngle = startAngle + (percentage/2 * unit - 0.001),\r\n\t\tx1 = radius + radius * Math.sin(startAngle),\r\n\t\ty1 = radius - radius * Math.cos(startAngle),\r\n\t\tx2 = radius + radius * Math.sin(endAngle),\r\n\t\ty2 = radius - radius * Math.cos(endAngle),\r\n\t\tx3 = radius + radius * 0.85 * Math.sin(labelAngle),\r\n\t\ty3 = radius - radius * 0.85 * Math.cos(labelAngle),\r\n\t\tbig = (endAngle - startAngle > Math.PI) ? 1 : 0;\r\n\r\n\tconst d = \"M \" + radius + \",\" + radius +\t// Start at circle center\r\n\t\t\t\" L \" + x1 + \",\" + y1 +\t\t\t\t// Draw line to (x1,y1)\r\n\t\t\t\" A \" + radius + \",\" + radius +\t// Draw an arc of radius r\r\n\t\t\t\" 0 \" + big + \" 1 \" +\t\t\t\t// Arc details...\r\n\t\t\tx2 + \",\" + y2 +\t\t\t\t\t\t// Arc goes to to (x2,y2)\r\n\t\t\t\" Z\";\t\t\t\t\t\t\t\t// Close path back to (cx,cy)\r\n\r\n\tconst path = svg.newEl(\"path\", {\r\n\t\tid : id,\r\n\t\td : d,\r\n\t\tfill : colour\r\n\t});\r\n\r\n\tpath.appendChild(svg.newEl(\"title\", {\r\n\t\ttext : labelTxt\r\n\t})); // Add tile to wedge path\r\n\tpath.addEventListener(\"mouseenter\", (evt) => {\r\n\t\tevt.target.style.opacity = \"0.5\";\r\n\t\tevt.target.ownerDocument.getElementById(evt.target.getAttribute(\"id\") + \"-table\").style.backgroundColor = \"#ccc\";\r\n\t});\r\n\tpath.addEventListener(\"mouseleave\", (evt) => {\r\n\t\tevt.target.style.opacity = \"1\";\r\n\t\tevt.target.ownerDocument.getElementById(evt.target.getAttribute(\"id\") + \"-table\").style.backgroundColor = \"transparent\";\r\n\t});\r\n\r\n\tif(percentage > 10){\r\n\t\tconst wedgeLabel = svg.newTextEl(labelTxt, y3);\r\n\r\n\t\t//first half or second half\r\n\t\tif(labelAngle < Math.PI){\r\n\t\t\twedgeLabel.setAttribute(\"x\", x3 - svg.getNodeTextWidth(wedgeLabel));\r\n\t\t}else{\r\n\t\t\twedgeLabel.setAttribute(\"x\", x3);\r\n\t\t}\r\n\r\n\t\treturn { path: path, wedgeLabel: wedgeLabel, endAngle: endAngle};\r\n\t}\r\n\treturn { path: path, endAngle: endAngle};\r\n};\r\n\r\n\r\nconst chartMaxHeight = (() => {\r\n\tconst contentWidth = (window.innerWidth * 0.98 - 64);\r\n\tif(contentWidth < 700){\r\n\t\treturn 350;\r\n\t} else if(contentWidth < 800){\r\n\t\treturn contentWidth / 2 - 72;\r\n\t} else {\r\n\t\treturn contentWidth / 3 - 72;\r\n\t}\r\n})();\r\n\r\npieChartHelpers.createPieChart = (data, size) => {\r\n\t//inspired by http://jsfiddle.net/da5LN/62/\r\n\r\n\tlet startAngle = 0; // init startAngle\r\n\tconst chart = svg.newEl(\"svg:svg\", {\r\n\t\t\tviewBox : \"0 0 \" + size + \" \" + size,\r\n\t\t\tclass : \"pie-chart\"\r\n\t\t}, \"max-height:\"+chartMaxHeight+\"px;\"),\r\n\t\tlabelWrap = svg.newEl(\"g\", {}, \"pointer-events:none; font-weight:bold;\"),\r\n\t\twedgeWrap = svg.newEl(\"g\");\r\n\r\n\t//loop through data and create wedges\r\n\tdata.forEach((dataObj) => {\r\n\t\tconst wedgeData = createWedge(dataObj.id, size, startAngle, dataObj.perc, dataObj.label + \" (\" + dataObj.count + \")\", dataObj.colour || helper.getRandomColor());\r\n\t\twedgeWrap.appendChild(wedgeData.path);\r\n\t\tstartAngle = wedgeData.endAngle;\r\n\r\n\t\tif(wedgeData.wedgeLabel){\r\n\t\t\tlabelWrap.appendChild(wedgeData.wedgeLabel);\r\n\t\t}\r\n\t});\r\n\r\n\t// foreground circle\r\n\twedgeWrap.appendChild(svg.newEl(\"circle\", {\r\n\t\tcx : size/2,\r\n\t\tcy : size/2,\r\n\t\tr : size*0.05,\r\n\t\tfill : \"#fff\"\r\n\t}));\r\n\tchart.appendChild(wedgeWrap);\r\n\tchart.appendChild(labelWrap);\r\n\treturn chart;\r\n};\r\n\r\n\r\npieChartHelpers.createChartTable = (title, data, columns) => {\r\n\tcolumns = columns || [{name: \"Requests\", field: \"count\"}];\r\n\r\n\t//create table\r\n\treturn dom.tableFactory(\"\", (thead) => {\r\n\t\t\tthead.appendChild(dom.newTag(\"th\", {text : title, class: \"text-left\"}));\r\n\t\t\tcolumns.forEach((column) => {\r\n\t\t\t\tthead.appendChild(dom.newTag(\"th\", {text : column.name, class: \"text-right\"}));\r\n\t\t\t});\r\n\t\t\tthead.appendChild(dom.newTag(\"th\", {text : \"Percentage\", class: \"text-right\"}));\r\n\r\n\t\t\treturn thead;\r\n\t\t}, (tbody) => {\r\n\t\t\tdata.forEach((y) => {\r\n\t\t\t\tconst row = dom.newTag(\"tr\", {id : y.id + \"-table\"});\r\n\t\t\t\trow.appendChild(dom.newTag(\"td\", {text : y.label}));\r\n\t\t\t\tcolumns.forEach((column) => {\r\n\t\t\t\t\trow.appendChild(dom.newTag(\"td\", {text : y[column.field].toString(), class: \"text-right\"}));\r\n\t\t\t\t});\r\n\t\t\t\trow.appendChild(dom.newTag(\"td\", {text : y.perc.toPrecision(2) + \"%\", class: \"text-right\"}));\r\n\t\t\t\ttbody.appendChild(row);\r\n\t\t\t});\r\n\t\t\treturn tbody;\r\n\t});\r\n};\r\n\r\n\r\nexport default pieChartHelpers;"],"file":"pieChartHelpers.js"}