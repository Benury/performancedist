{"version":3,"sources":["../../tempCollect/helpers/waterfall.js"],"names":["waterfall","timeBlock","name","start","end","cssClass","segments","rawResource","total","undefined","setupTimeLine","durationMs","blocks","marks","lines","title","unit","barsToShow","filter","block","sort","a","b","maxMarkTextLength","length","reduce","currMax","currValue","Math","max","svg","getNodeTextWidth","newTextEl","diagramHeight","chartHolderHeight","chartHolder","dom","newTag","timeLineHolder","newEl","height","floor","timeLineLabelHolder","endLine","x1","y1","x2","y2","startLine","onRectMouseEnter","evt","targetRect","target","addClass","xPosEnd","x","baseVal","valueInSpecifiedUnits","width","xPosStart","valueAsString","parentNode","appendChild","onRectMouseLeave","removeClass","createRect","y","label","rectHolder","rect","round","text","addEventListener","forEach","segment","createBgRect","createTimeWrapper","timeHolder","i","secs","secPerc","lineLabel","setAttribute","lineEl","renderMarks","marksHolder","transform","mark","startTime","markHolder","lineHolder","lineLabelHolder","isActive","onLabelMouseEnter","onLabelMouseLeave","blockWidth","blockLabel","style","opacity","match"],"mappings":"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","sourcesContent":["/*\r\nHelper to create waterfall timelines\r\n*/\r\nimport svg from \"../helpers/svg\";\r\nimport dom from \"../helpers/dom\";\r\n\r\nconst waterfall = {};\r\n\r\n\r\n//model for block and segment\r\nwaterfall.timeBlock = (name, start, end, cssClass, segments, rawResource) => {\r\n\treturn {\r\n\t\tname : name,\r\n\t\tstart : start,\r\n\t\tend : end,\r\n\t\ttotal : ((typeof start !== \"number\" || typeof end !== \"number\") ? undefined : (end - start)),\r\n\t\tcssClass : cssClass,\r\n\t\tsegments : segments,\r\n\t\trawResource : rawResource\r\n\t}\r\n};\r\n\r\nwaterfall.setupTimeLine = (durationMs, blocks, marks, lines, title) => {\r\n\tconst unit = durationMs / 100,\r\n\t\tbarsToShow = blocks\r\n\t\t\t.filter((block) => (typeof block.start == \"number\" && typeof block.total == \"number\"))\r\n\t\t\t.sort((a, b) => (a.start||0) - (b.start||0)),\r\n\t\tmaxMarkTextLength = marks.length > 0 ? marks.reduce((currMax, currValue) => {\r\n\t\t\treturn Math.max((typeof currMax == \"number\" ? currMax : 0), svg.getNodeTextWidth( svg.newTextEl(currValue.name, \"0\")));\r\n\t\t}) : 0,\r\n\t\tdiagramHeight = (barsToShow.length + 1) * 25,\r\n\t\tchartHolderHeight = diagramHeight + maxMarkTextLength + 35;\r\n\r\n\tconst chartHolder = dom.newTag(\"section\", {\r\n\t\tclass : \"resource-timing water-fall-holder chart-holder\"\r\n\t});\r\n\tconst timeLineHolder = svg.newEl(\"svg:svg\", {\r\n\t\theight : Math.floor(chartHolderHeight),\r\n\t\tclass : \"water-fall-chart\"\r\n\t});\r\n\tconst timeLineLabelHolder = svg.newEl(\"g\", {class : \"labels\"});\r\n\r\n\tconst endLine = svg.newEl(\"line\", {\r\n\t\tx1 : \"0\",\r\n\t\ty1 : \"0\",\r\n\t\tx2 : \"0\",\r\n\t\ty2 : diagramHeight,\r\n\t\tclass : \"line-end\"\r\n\t});\r\n\r\n\tconst startLine = svg.newEl(\"line\", {\r\n\t\tx1 : \"0\",\r\n\t\ty1 : \"0\",\r\n\t\tx2 : \"0\",\r\n\t\ty2 : diagramHeight,\r\n\t\tclass : \"line-start\"\r\n\t});\r\n\r\n\tconst onRectMouseEnter = (evt) => {\r\n\t\tconst targetRect = evt.target;\r\n\t\tdom.addClass(targetRect, \"active\");\r\n\r\n\t\tconst xPosEnd = targetRect.x.baseVal.valueInSpecifiedUnits + targetRect.width.baseVal.valueInSpecifiedUnits + \"%\";\r\n\t\tconst xPosStart = targetRect.x.baseVal.valueInSpecifiedUnits + \"%\";\r\n\r\n\t\tendLine.x1.baseVal.valueAsString = xPosEnd;\r\n\t\tendLine.x2.baseVal.valueAsString = xPosEnd;\r\n\t\tstartLine.x1.baseVal.valueAsString = xPosStart;\r\n\t\tstartLine.x2.baseVal.valueAsString = xPosStart;\r\n\t\tdom.addClass(endLine, \"active\");\r\n\t\tdom.addClass(startLine, \"active\");\r\n\r\n\t\ttargetRect.parentNode.appendChild(endLine);\r\n\t\ttargetRect.parentNode.appendChild(startLine);\r\n\t};\r\n\r\n\tconst onRectMouseLeave = (evt) => {\r\n\t\tdom.removeClass(evt.target, \"active\");\r\n\t\tdom.removeClass(endLine, \"active\");\r\n\t\tdom.removeClass(startLine, \"active\");\r\n\t};\r\n\r\n\tconst createRect = (width, height, x, y, cssClass, label, segments) => {\r\n\t\tlet rectHolder;\r\n\t\tconst rect = svg.newEl(\"rect\", {\r\n\t\t\twidth : (width / unit) + \"%\",\r\n\t\t\theight : height-1,\r\n\t\t\tx :  Math.round((x / unit)*100)/100 + \"%\",\r\n\t\t\ty : y,\r\n\t\t\tclass : ((segments && segments.length > 0 ? \"time-block\" : \"segment\")) + \" \" +  (cssClass || \"block-undefined\")\r\n\t\t});\r\n\t\tif(label){\r\n\t\t\trect.appendChild(svg.newEl(\"title\", {\r\n\t\t\t\ttext : label\r\n\t\t\t})); // Add tile to wedge path\r\n\t\t}\r\n\r\n\t\trect.addEventListener(\"mouseenter\", onRectMouseEnter);\r\n\t\trect.addEventListener(\"mouseleave\", onRectMouseLeave);\r\n\r\n\t\tif(segments && segments.length > 0){\r\n\t\t\trectHolder = svg.newEl(\"g\");\r\n\t\t\trectHolder.appendChild(rect);\r\n\t\t\tsegments.forEach((segment) => {\r\n\t\t\t\tif(segment.total > 0 && typeof segment.start === \"number\"){\r\n\t\t\t\t\trectHolder.appendChild(createRect(segment.total, 8, segment.start||0.001, y, segment.cssClass, segment.name + \" (\" + Math.round(segment.start) + \"ms - \" +  Math.round(segment.end) + \"ms | total: \" + Math.round(segment.total) + \"ms)\"));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn rectHolder;\r\n\t\t}else{\r\n\t\t\treturn rect;\r\n\t\t}\r\n\t};\r\n\r\n\tconst createBgRect = (block) => {\r\n\t\tconst rect = svg.newEl(\"rect\", {\r\n\t\t\twidth : ((block.total||1) / unit) + \"%\",\r\n\t\t\theight : diagramHeight,\r\n\t\t\tx :  ((block.start||0.001) / unit) + \"%\",\r\n\t\t\ty : 0,\r\n\t\t\tclass : block.cssClass || \"block-undefined\"\r\n\t\t});\r\n\r\n\t\trect.appendChild(svg.newEl(\"title\", {\r\n\t\t\ttext : block.name\r\n\t\t})); // Add tile to wedge path\r\n\t\treturn rect;\r\n\t};\r\n\r\n\tconst createTimeWrapper = () => {\r\n\t\tconst timeHolder = svg.newEl(\"g\", { class : \"time-scale full-width\" });\r\n\t\tfor(let i = 0, secs = durationMs / 1000, secPerc = 100 / secs; i <= secs; i++){\r\n\t\t\tconst lineLabel = svg.newTextEl(i + \"sec\",  diagramHeight);\r\n\t\t\tif(i > secs - 0.2){\r\n\t\t\t\tlineLabel.setAttribute(\"x\", secPerc * i - 0.5 + \"%\");\r\n\t\t\t\tlineLabel.setAttribute(\"text-anchor\", \"end\");\r\n\t\t\t}else{\r\n\t\t\t\tlineLabel.setAttribute(\"x\", secPerc * i + 0.5 + \"%\");\r\n\t\t\t}\r\n\r\n\t\t\tconst lineEl = svg.newEl(\"line\", {\r\n\t\t\t\tx1 : secPerc * i + \"%\",\r\n\t\t\t\ty1 : \"0\",\r\n\t\t\t\tx2 : secPerc * i + \"%\",\r\n\t\t\t\ty2 : diagramHeight\r\n\t\t\t});\r\n\t\t\ttimeHolder.appendChild(lineEl);\r\n\t\t\ttimeHolder.appendChild(lineLabel);\r\n\t\t}\r\n\t\treturn timeHolder;\r\n\t};\r\n\r\n\r\n\tconst renderMarks = () => {\r\n\t\tconst marksHolder = svg.newEl(\"g\", {\r\n\t\t\ttransform : \"scale(1, 1)\",\r\n\t\t\tclass : \"marker-holder\"\r\n\t\t});\r\n\r\n\t\tmarks.forEach((mark, i) => {\r\n\t\t\tconst x = mark.startTime / unit;\r\n\t\t\tconst markHolder = svg.newEl(\"g\", {\r\n\t\t\t\tclass : \"mark-holder\"\r\n\t\t\t});\r\n\t\t\tconst lineHolder = svg.newEl(\"g\", {\r\n\t\t\t\tclass : \"line-holder\"\r\n\t\t\t});\r\n\t\t\tconst lineLabelHolder = svg.newEl(\"g\", {\r\n\t\t\t\tclass : \"line-label-holder\",\r\n\t\t\t\tx : x + \"%\"\r\n\t\t\t});\r\n\t\t\tmark.x = x;\r\n\t\t\tconst lineLabel = svg.newTextEl(mark.name,  diagramHeight + 25 );\r\n\t\t\t//lineLabel.setAttribute(\"writing-mode\", \"tb\");\r\n\t\t\tlineLabel.setAttribute(\"x\", x + \"%\");\r\n\t\t\tlineLabel.setAttribute(\"stroke\", \"\");\r\n\r\n\r\n\t\t\tlineHolder.appendChild(svg.newEl(\"line\", {\r\n\t\t\t\tx1 : x + \"%\",\r\n\t\t\t\ty1 : 0,\r\n\t\t\t\tx2 : x + \"%\",\r\n\t\t\t\ty2 : diagramHeight\r\n\t\t\t}));\r\n\r\n\t\t\tif(marks[i-1] && mark.x - marks[i-1].x < 1){\r\n\t\t\t\tlineLabel.setAttribute(\"x\", marks[i-1].x+1 + \"%\");\r\n\t\t\t\tmark.x = marks[i-1].x+1;\r\n\t\t\t}\r\n\r\n\t\t\t//would use polyline but can't use percentage for points\r\n\t\t\tlineHolder.appendChild(svg.newEl(\"line\", {\r\n\t\t\t\tx1 : x + \"%\",\r\n\t\t\t\ty1 : diagramHeight,\r\n\t\t\t\tx2 : mark.x + \"%\",\r\n\t\t\t\ty2 : diagramHeight + 23\r\n\t\t\t}));\r\n\r\n\t\t\tlet isActive = false;\r\n\t\t\tconst onLabelMouseEnter = (evt) => {\r\n\t\t\t\tif(!isActive){\r\n\t\t\t\t\tisActive = true;\r\n\t\t\t\t\tdom.addClass(lineHolder, \"active\");\r\n\t\t\t\t\t//firefox has issues with this\r\n\t\t\t\t\tmarkHolder.parentNode.appendChild(markHolder);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tconst onLabelMouseLeave = (evt) => {\r\n\t\t\t\tisActive = false;\r\n\t\t\t\tdom.removeClass(lineHolder, \"active\");\r\n\t\t\t};\r\n\r\n\t\t\tlineLabel.addEventListener(\"mouseenter\", onLabelMouseEnter);\r\n\t\t\tlineLabel.addEventListener(\"mouseleave\", onLabelMouseLeave);\r\n\t\t\tlineLabelHolder.appendChild(lineLabel);\r\n\r\n\t\t\tmarkHolder.appendChild(svg.newEl(\"title\", {\r\n\t\t\t\ttext : mark.name + \" (\" + Math.round(mark.startTime) + \"ms)\",\r\n\t\t\t}));\r\n\t\t\tmarkHolder.appendChild(lineHolder);\r\n\t\t\tmarksHolder.appendChild(markHolder);\r\n\t\t\tmarkHolder.appendChild(lineLabelHolder);\r\n\t\t});\r\n\r\n\t\treturn marksHolder;\r\n\t};\r\n\r\n\ttimeLineHolder.appendChild(createTimeWrapper());\r\n\ttimeLineHolder.appendChild(renderMarks());\r\n\r\n\tlines.forEach((block, i) => {\r\n\t\ttimeLineHolder.appendChild(createBgRect(block));\r\n\t});\r\n\r\n\tbarsToShow.forEach((block, i) => {\r\n\t\tconst blockWidth = block.total||1;\r\n\r\n\t\tconst y = 25 * i;\r\n\t\ttimeLineHolder.appendChild(createRect(blockWidth, 25, block.start||0.001, y, block.cssClass, block.name + \" (\" + block.start + \"ms - \" + block.end + \"ms | total: \" + block.total + \"ms)\", block.segments));\r\n\r\n\t\tconst blockLabel = svg.newTextEl(block.name + \" (\" + Math.round(block.total) + \"ms)\", (y + (block.segments? 20 : 17)));\r\n\r\n\t\tif(((block.total||1) / unit) > 10 && svg.getNodeTextWidth(blockLabel) < 200){\r\n\t\t\tblockLabel.setAttribute(\"class\", \"inner-label\");\r\n\t\t\tblockLabel.setAttribute(\"x\", ((block.start||0.001) / unit) + 0.5 + \"%\");\r\n\t\t\tblockLabel.setAttribute(\"width\", (blockWidth / unit) + \"%\");\r\n\t\t}else if(((block.start||0.001) / unit) + (blockWidth / unit) < 80){\r\n\t\t\tblockLabel.setAttribute(\"x\", ((block.start||0.001) / unit) + (blockWidth / unit) + 0.5 + \"%\");\r\n\t\t}else {\r\n\t\t\tblockLabel.setAttribute(\"x\", (block.start||0.001) / unit - 0.5 + \"%\");\r\n\t\t\tblockLabel.setAttribute(\"text-anchor\", \"end\");\r\n\t\t}\r\n\t\tblockLabel.style.opacity = block.name.match(/js.map$/) ? \"0.5\" : \"1\";\r\n\t\ttimeLineLabelHolder.appendChild(blockLabel);\r\n\t});\r\n\r\n\ttimeLineHolder.appendChild(timeLineLabelHolder);\r\n\r\n\tif(title){\r\n\t\tchartHolder.appendChild(dom.newTag(\"h1\", {\r\n\t\t\ttext : title\r\n\t\t}));\r\n\t}\r\n\tchartHolder.appendChild(timeLineHolder);\r\n\r\n\r\n\r\n\r\n\treturn chartHolder;\r\n};\r\n\r\nexport default waterfall;\r\n"],"file":"waterfall.js"}